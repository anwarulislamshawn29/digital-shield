<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firewall - Connection Control</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sora:wght@600&family=Inter:wght@400;500;600&display=swap');
        :root {
            --bg-light: #f6f7f9; 
            --bg-dark: #0a0c10;
            --header-bg-light: linear-gradient(180deg, #ffffff 0%, #fcfdff 100%);
            --header-bg-dark: linear-gradient(180deg, #1a1f29 0%, #161b22 100%);
            --card-bg-light: #ffffff; 
            --card-bg-dark: #161b22;
            --border-light: #dfe3e8;
            --border-dark: #2a3038;
            --text-primary-light: #1d2129; --text-primary-dark: #e6edf3;
            --text-secondary-light: #606770; --text-secondary-dark: #909dab;
            --accent-blue: #0d6efd; --accent-green: #198754; --accent-red: #dc3545;
            --glow-blue: rgba(13, 110, 253, 0.3);
            --input-bg-light: #f0f2f5;
            --input-bg-dark: #0a0c10;
        }
        body {
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-light); 
            color: var(--text-primary-light);
            width: 500px; height: 600px; margin: 0; 
            display: flex; flex-direction: column;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        html.dark body { 
            background-color: var(--bg-dark); 
            color: var(--text-primary-dark); 
        }
        
        header {
            padding: 1.25rem 1.5rem; 
            flex-shrink: 0;
            border-bottom: 1px solid var(--border-light);
            background: var(--header-bg-light);
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        html.dark header { border-color: var(--border-dark); background: var(--header-bg-dark); }
        header h1 { 
            font-family: 'Sora', sans-serif;
            font-size: 1.5rem; 
            margin: 0 0 0.25rem 0; 
            font-weight: 600; 
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        #current-site-header { font-size: 0.85rem; color: var(--text-secondary-light); font-weight: 500; }
        html.dark #current-site-header { color: var(--text-secondary-dark); }

        main { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 1.5rem;
        }
        .section { margin-bottom: 2rem; }
        .section-title { 
            font-family: 'Sora', sans-serif;
            font-size: 0.9rem; font-weight: 600; color: var(--text-primary-light); 
            padding-bottom: 0.75rem; margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }
        html.dark .section-title { color: var(--text-primary-dark); border-color: var(--border-dark); }

        .card {
            background-color: var(--card-bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.03), 0 2px 4px -2px rgba(0,0,0,0.03);
        }
        html.dark .card { background-color: var(--card-bg-dark); border-color: var(--border-dark); }

        .form-container { display: flex; gap: 0.5rem; padding: 0.75rem; background-color: var(--input-bg-light); border-radius: 8px; }
        html.dark .form-container { background-color: var(--input-bg-dark); }
        .form-input {
            flex-grow: 1; 
            border: none; 
            background-color: transparent;
            color: var(--text-primary-light); 
            padding: 0.6rem 0.5rem; 
            font-size: 0.9rem;
            outline: none;
        }
        html.dark .form-input { color: var(--text-primary-dark); }
        
        .form-btn {
            border: none; 
            background-image: linear-gradient(to right, #0d6efd 0%, #0d6efd 50%, #0a58ca 100%);
            background-size: 200% auto;
            color: white; 
            border-radius: 6px;
            font-weight: 600; 
            padding: 0.6rem 1.2rem; 
            cursor: pointer; 
            transition: all 0.3s ease-in-out;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .form-btn:hover { background-position: right center; }
        
        .toggle-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border-light);
        }
        html.dark .toggle-item { border-color: var(--border-dark); }
        .toggle-item:last-child { border-bottom: none; }
        .toggle-item-label { display: flex; align-items: center; gap: 0.75rem; font-weight: 500; font-size: 0.9rem; }
        
        .toggle-switch { width: 40px; height: 22px; background-color: #d1d5da; border-radius: 9999px; transition: all 0.3s; position: relative; cursor: pointer; }
        html.dark .toggle-switch { background-color: #30363d; }
        .toggle-switch::before { content: ''; position: absolute; left: 2px; top: 2px; width: 18px; height: 18px; background-color: white; border-radius: 50%; transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1); box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        html.dark .toggle-switch::before { background-color: #8b949e; }
        input:checked + .toggle-switch { background-color: var(--accent-green); }
        html.dark input:checked + .toggle-switch::before { background-color: #c9d1d9; }
        input:checked + .toggle-switch::before { transform: translateX(18px); }
        .toggle-checkbox { display: none; }

        .connection-list { list-style: none; padding: 0; margin: 0; max-height: 200px; overflow-y: auto; }
        .connection-item {
            display: flex; align-items: center; padding: 0.75rem 1.25rem;
            border-bottom: 1px solid var(--border-light);
        }
        html.dark .connection-item { border-color: var(--border-dark); }
        .connection-item:last-child { border-bottom: none; }
        .domain-name { flex-grow: 1; font-weight: 500; font-size: 0.9rem; }
        
        .status-indicator { display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; font-weight: 600; color: var(--text-secondary-light); }
        html.dark .status-indicator { color: var(--text-secondary-dark); }
        .status-indicator .dot { width: 8px; height: 8px; border-radius: 50%; background-color: var(--accent-green); }

        .remove-btn { background: none; border: none; color: var(--text-secondary-light); cursor: pointer; padding: 0.25rem; border-radius: 50%; transition: all 0.2s; }
        .remove-btn:hover { color: var(--accent-red); background-color: rgba(215, 58, 73, 0.1); }
        html.dark .remove-btn { color: var(--text-secondary-dark); }
        html.dark .remove-btn:hover { color: #ff7b72; }

        .info-tooltip { position: relative; display: inline-flex; }
        .info-icon { color: var(--text-secondary-light); cursor: help; }
        html.dark .info-icon { color: var(--text-secondary-dark); }
        .tooltip-text {
            visibility: hidden; width: 220px; background-color: #24292e; color: #c9d1d9;
            text-align: left; border-radius: 6px; padding: 0.75rem; position: absolute; z-index: 10;
            bottom: 135%; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); font-size: 0.8rem; font-weight: 400; line-height: 1.5;
        }
        .info-tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }

        .empty-list-item {
            justify-content: center;
            color: var(--text-secondary-light);
            font-style: italic;
            font-size: 0.85rem;
            text-align: center;
            padding: 1rem;
        }
        html.dark .empty-list-item {
            color: var(--text-secondary-dark);
        }
    </style>
</head>
<body>
    <header>
        <h1>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            Firewall Control
        </h1>
        <p id="current-site-header">Connections for: loading...</p>
    </header>
    <main>
         <div class="section">
             <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h8"></path><path d="m22 17-2 2-2-2"></path><path d="M16 17h6"></path></svg>
                Live Connections
            </h2>
            <div class="card">
                <ul id="third-party-list" class="connection-list"></ul>
                <ul id="first-party-list" class="connection-list"></ul>
            </div>
        </div>
        <div class="section">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><path d="m9 12 2 2 4-4"></path></svg>
                Global Controls
            </h2>
            <div class="card">
                <div class="toggle-item">
                    <div class="toggle-item-label">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                        <label for="block-scripts">Block 3rd-Party Scripts</label>
                        <div class="info-tooltip">
                            <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.064.293.006.399.287.47l.45.083.082.38-2.29-.287a.5.5 0 0 1-.45-.492l.738-3.468a.5.5 0 0 1 .45-.492l2.05-.293a.5.5 0 0 1 .492.45zm-1.105-1.443a.5.5 0 1 1-.99 0 .5.5 0 0 1 .99 0z"/></svg>
                            <span class="tooltip-text">Stops external tracking and ad scripts to boost your privacy, security, and browsing speed.</span>
                        </div>
                    </div>
                    <input type="checkbox" id="block-scripts" class="toggle-checkbox">
                    <label for="block-scripts" class="toggle-switch"></label>
                </div>
                <div class="toggle-item">
                     <div class="toggle-item-label">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path><path d="M2 2l20 20"></path></svg>
                        <label for="block-webrtc">Block WebRTC</label>
                        <div class="info-tooltip">
                            <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.064.293.006.399.287.47l.45.083.082.38-2.29-.287a.5.5 0 0 1-.45-.492l.738-3.468a.5.5 0 0 1 .45-.492l2.05-.293a.5.5 0 0 1 .492.45zm-1.105-1.443a.5.5 0 1 1-.99 0 .5.5 0 0 1 .99 0z"/></svg>
                            <span class="tooltip-text">Prevents IP address leaks to protect your true location, which is essential for VPN users.</span>
                        </div>
                    </div>
                    <input type="checkbox" id="block-webrtc" class="toggle-checkbox">
                    <label for="block-webrtc" class="toggle-switch"></label>
                </div>
            </div>
        </div>

        <!-- NEW: Allow List Section -->
        <div class="section">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><path d="m9 12 2 2 4-4"></path></svg>
                Allow List Mode
            </h2>
            <div class="card">
                <div class="toggle-item">
                    <div class="toggle-item-label">
                        <label for="allow-list-mode-enabled">Enable Allow List Mode</label>
                        <div class="info-tooltip">
                            <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.064.293.006.399.287.47l.45.083.082.38-2.29-.287a.5.5 0 0 1-.45-.492l.738-3.468a.5.5 0 0 1 .45-.492l2.05-.293a.5.5 0 0 1 .492.45zm-1.105-1.443a.5.5 0 1 1-.99 0 .5.5 0 0 1 .99 0z"/></svg>
                            <span class="tooltip-text">When enabled, ONLY websites on your allow list will be accessible. All others will be blocked.</span>
                        </div>
                    </div>
                    <input type="checkbox" id="allow-list-mode-enabled" class="toggle-checkbox">
                    <label for="allow-list-mode-enabled" class="toggle-switch"></label>
                </div>
                <div id="allow-list-controls">
                    <div class="form-container">
                        <input type="text" id="allowlist-input" class="form-input" placeholder="e.g., trusted-site.com">
                        <button id="allowlist-add-btn" type="button" class="form-btn">Allow</button>
                    </div>
                    <ul id="allowlist-list" class="connection-list"></ul>
                </div>
            </div>
        </div>


        <div class="section">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                Custom Blocklist
            </h2>
            <div class="card">
                <div class="form-container">
                    <input type="text" id="blocklist-input" class="form-input" placeholder="e.g., annoying-ads.com">
                    <button id="blocklist-add-btn" type="button" class="form-btn">Block</button>
                </div>
                <ul id="blocklist-list" class="connection-list"></ul>
            </div>
        </div>
    </main>
    <script src="firewall.js"></script>
</body>
</html>
